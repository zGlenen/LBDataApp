{% extends 'base.html' %}

{% block head %}
  <title>Films Wrapped - Films</title>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="filter_multi_select.css" />
  <script src="filter-multi-select-bundle.min.js"></script>
  <style>

        .dropdown-menu .dropdown-header {
          width: 100%;
          margin-top: 0.5rem; /* Adjust spacing */
          margin-bottom: 0.25rem; /* Adjust spacing */
        }

        .dropdown-menu .dropdown-divider {
          width: 100%;
          margin: 0.5rem 0;
          border-top: 1px solid #6c757d;
        }

        #ulfilter li {
          display: flex;
          flex-basis: calc(50% - 0.5rem); /* Adjust column width and spacing */
        }

        /* Optional: Adjust checkbox styles */
        #ulfilter input[type="checkbox"] {
          margin-right: 0.5rem; /* Adjust spacing */
        }

  </style>
{% endblock %}

{% block body %}

<div class="text-center">
  <div class="row">
    <div class="col-sm-8">
      <div class="dropdown ">
        <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownfilter" data-bs-auto-close="outside" data-bs-toggle="dropdown" aria-expanded="false">
          Filter
        </button>
        <ul class="dropdown-menu dropdown-menu-dark p-2 m-2" id="ulfilter" aria-labelledby="dropdownMenuButton2">
          <div class="row">
            <div class="col">
              <li class="dropdown-header">Your Rating</li>
              <li><input type="checkbox" value="user_0" />Not Rated</li>
              <li><input type="checkbox" value="user_1" />½</li>
              <li><input type="checkbox" value="user_2" />★</li>
              <li><input type="checkbox" value="user_3" />★½</li>
              <li><input type="checkbox" value="user_4"/>★★</li>
              <li><input type="checkbox" value="user_5"/>★★½</li>
              <li><input type="checkbox" value="user_6"/>★★★</li>
              <li><input type="checkbox" value="user_7"/>★★★½</li>
              <li><input type="checkbox" value="user_8"/>★★★★</li>
              <li><input type="checkbox" value="user_9"/>★★★★½</li>
              <li><input type="checkbox" value="user_10"/>★★★★★</li>
            </div>
            <div class="col">
              <li class="dropdown-header">Average Rating</li>
              <li><input type="checkbox" value="avg_0"/>Not Rated</a></li>
              <li><input type="checkbox" value="avg_1"/>0.5</a></li>
              <li><input type="checkbox" value="avg_2"/>1.0</a></li>
              <li><input type="checkbox" value="avg_3"/>1.5</a></li>
              <li><input type="checkbox" value="avg_4"/>2</a></li>
              <li><input type="checkbox" value="avg_5"/>2.5</a></li>
              <li><input type="checkbox" value="avg_6"/>3</a></li>
              <li><input type="checkbox" value="avg_7"/>3.5</a></li>
              <li><input type="checkbox" value="avg_8"/>4</a></li>
              <li><input type="checkbox" value="avg_9"/>4.5</a></li>
            </div>
            <div class="col">
              <li class="dropdown-header">Decade</li>
              <li><input type="checkbox" value="dec_2020"/>2020s</a></li>
              <li><input type="checkbox" value="dec_2010"/>2010s</a></li>
              <li><input type="checkbox" value="dec_2000"/>2000s</a></li>
              <li><input type="checkbox" value="dec_1990"/>1990s</a></li>
              <li><input type="checkbox" value="dec_1980"/>1980s</a></li>
              <li><input type="checkbox" value="dec_1970"/>1970s</a></li>
              <li><input type="checkbox" value="dec_1960"/>1960s</a></li>
              <li><input type="checkbox" value="dec_1950"/>1950s</a></li>
              <li><input type="checkbox" value="dec_1940"/>1940s</a></li>
              <li><input type="checkbox" value="dec_1930"/>1930s</a></li>
              <li><input type="checkbox" value="dec_1920"/>1920s</a></li>
              <li><input type="checkbox" value="dec_1910"/>1910s</a></li>
              <li><input type="checkbox" value="dec_1900"/>1900s</a></li>
              <li><input type="checkbox" value="dec_1800"/>1800s</a></li>
            </div>
            <div class="col">
              <li class="dropdown-header">Year</li>
              <li><input type="checkbox" value="year_1"/>1</a></li>
              <li><input type="checkbox" value="year_2"/>2</a></li>
              <li><input type="checkbox" value="year_3"/>3</a></li>
              <li><input type="checkbox" value="year_4"/>4</a></li>
              <li><input type="checkbox" value="year_5"/>5</a></li>
              <li><input type="checkbox" value="year_6"/>6</a></li>
              <li><input type="checkbox" value="year_7"/>7</a></li>
              <li><input type="checkbox" value="year_8"/>8</a></li>
              <li><input type="checkbox" value="year_9"/>9</a></li>
            </div>
          </div>
          
          
          <li class="dropdown-divider"></li>
          <li><a class="btn btn-secondary" id="getEmBtn" type="button" href="#" aria-expanded="false">Get 'Em</a></li>
        </ul>
      </div>
      </div>
      <div class="col-sm-4">
        <div class="dropdown">
          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton2" data-bs-auto-close="outside" data-bs-toggle="dropdown" aria-expanded="false">
            Sort
          </button>
          <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="dropdownMenuButton2">
            <li><a class="dropdown-item" href="?sorting_option=year_latest">Year Latest</a></li>
            <li><a class="dropdown-item" href="?sorting_option=year_earliest">Year Earliest</a></li>
            <li><a class="dropdown-item" href="?sorting_option=rating_highest">Rating Highest</a></li>
            <li><a class="dropdown-item" href="?sorting_option=rating_lowest">Rating Lowest</a></li>
            <li><a class="dropdown-item" href="?sorting_option=user_rating_highest">User Rating Highest</a></li>
            <li><a class="dropdown-item" href="?sorting_option=user_rating_lowest">User Rating Lowest</a></li>
            <li><a class="dropdown-item" href="?sorting_option=longest">Longest</a></li>
            <li><a class="dropdown-item" href="?sorting_option=shortest">Shortest</a></li>
      
          </ul>
        </div>
      </div>
  </div>

  <table class="table table-dark table-sm w-auto mx-auto">
      <thead>
          <tr>
              <th scope="col">Title</th>
              <th scope="col">Your Rating</th>
              <th scope="col">Release Year</th>
              <th scope="col">Runtime</th>
              <th scope="col">Director</th>
              <th scope="col">Poster</th>
              <th scope="col">Average Rating</th>
          </tr>
      </thead>
      <tbody>
          {% for film in films %}
          <tr>
              <td class="align-middle">{{ film.title }}</td>
              <td class="align-middle">{{ film.details.user_rating }}</td>
              <td class="align-middle">{{ film.year_released }}</td>
              <td class="align-middle">{{ film.details.runtime }}</td>
              <td class="align-middle">
                  {% set director_count = 0 %}
                  {% for crew_member in film.details.crew %}
                      {% if crew_member.job == 'Director' %}
                          {% if director_count > 0 %}, {% endif %}
                          {{ crew_member.name }}
                          {% set director_count = director_count + 1 %}
                      {% endif %}
                  {% endfor %}
              </td>
              <td class="align-middle"><a href="{{ film.letterboxd_uri }}"><img style="max-height: 100px;" src="https://image.tmdb.org/t/p/original/{{ film.details.image_url }}"></a></td>
              <td class="align-middle">{{ film.details.rating }}</td>

          </tr>
          {% endfor %}
          <!-- Pagination -->

      </tbody>
  </table>
  <div class="text-center">
    <ul class="pagination justify-content-center">
        {{ pagination.links }}
    </ul>
    {{ pagination.info }}

  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const decadeCheckboxes = document.querySelectorAll('input[type="checkbox"][value^="dec_"]');
    const yearCheckboxes = document.querySelectorAll('input[type="checkbox"][value^="year_"]');
    
    // Initially disable year checkboxes
    function disableYear(){
        yearCheckboxes.forEach(function(checkbox) {
        checkbox.disabled = true;
      });
    }


    // Function to enable/disable year checkboxes based on decade checkboxes
    function updateYearCheckboxes() {
      let isDecadeChecked = false;
      let counter = 0
      decadeCheckboxes.forEach(function(checkbox) {

        if (checkbox.checked) {
          counter++
          isDecadeChecked = true;
        }
        if (counter > 1){
          isDecadeChecked = false;
        }
      });

      yearCheckboxes.forEach(function(checkbox) {
        checkbox.disabled = !isDecadeChecked;
        checkbox.checked = false; // Uncheck year checkboxes if no decade checkbox is checked
      });
    }

    // Add event listener to decade checkboxes to update year checkboxes
    decadeCheckboxes.forEach(function(checkbox) {
      checkbox.addEventListener('change', updateYearCheckboxes);
    });

    // Initially update the state of year checkboxes
    updateYearCheckboxes();
    disableYear();
  });
  
  document.getElementById('getEmBtn').addEventListener('click', function(event) {
      event.preventDefault(); // Prevent default link behavior

      // Get all the checked checkboxes
      const checkboxes = document.querySelectorAll('#ulfilter input[type="checkbox"]:checked');

      // Construct the URL with checkbox values as query parameters
      let url = '?';
      checkboxes.forEach(function(checkbox, index) {
          if (index !== 0) {
              url += '&';
          }
          url += encodeURIComponent(checkbox.value) + '=true';
      });

      // Redirect to the constructed URL
      window.location.href = url;
  });
  document.getElementById('navbar').style.display = 'block';

</script>
   
{% endblock %}
